


<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="BRV框架文档">
      
      
      
        <meta name="author" content="drake">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.1">
    
    
      
        <title>下拉刷新/上拉加载 - BRV</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.5d00201e.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=JetBrains+Mono:300,400,400i,700%7CJetBrains+Mono&display=fallback">
        <style>body,input{font-family:"JetBrains Mono",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"JetBrains Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pagerefreshlayout" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="BRV" class="md-header-nav__button md-logo" aria-label="BRV">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            BRV
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              下拉刷新/上拉加载
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/liangjingkanji/BRV/" title="前往 GitHub 仓库" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    BRV
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BRV" class="md-nav__button md-logo" aria-label="BRV">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    BRV
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/liangjingkanji/BRV/" title="前往 GitHub 仓库" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    BRV
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="介绍" class="md-nav__link">
      介绍
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../use/" title="使用" class="md-nav__link">
      使用
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../multi_type/" title="多类型" class="md-nav__link">
      多类型
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../listener/" title="监听事件" class="md-nav__link">
      监听事件
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../header_footer/" title="头脚布局" class="md-nav__link">
      头脚布局
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../group/" title="分组" class="md-nav__link">
      分组
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../hover/" title="悬停" class="md-nav__link">
      悬停
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../divider/" title="分割线" class="md-nav__link">
      分割线
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        下拉刷新/上拉加载
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="下拉刷新/上拉加载" class="md-nav__link md-nav__link--active">
      下拉刷新/上拉加载
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      目录
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pagerefreshlayout" class="md-nav__link">
    PageRefreshLayout
  </a>
  
    <nav class="md-nav" aria-label="PageRefreshLayout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    创建方式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    监听状态
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    缺省页
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    刷新数据
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../state/" title="缺省页" class="md-nav__link">
      缺省页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../upfetch/" title="拉取更多" class="md-nav__link">
      拉取更多
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../toggle/" title="切换模式" class="md-nav__link">
      切换模式
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../checked/" title="选择模式" class="md-nav__link">
      选择模式
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../flexbox/" title="伸缩布局" class="md-nav__link">
      伸缩布局
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../drag_swipe/" title="拖拽/侧滑" class="md-nav__link">
      拖拽/侧滑
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ktx/" title="快捷函数" class="md-nav__link">
      快捷函数
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../net/" title="网络请求" class="md-nav__link">
      网络请求
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      目录
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pagerefreshlayout" class="md-nav__link">
    PageRefreshLayout
  </a>
  
    <nav class="md-nav" aria-label="PageRefreshLayout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    创建方式
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    监听状态
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    缺省页
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    刷新数据
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/liangjingkanji/BRV/edit/master/docs/refresh.md" title="编辑此页" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                  <h1>下拉刷新/上拉加载</h1>
                
                <p>BRV的下拉刷新和上拉加载扩展自 <a href="https://github.com/scwang90/SmartRefreshLayout">SmartRefreshLayout</a>, 支持其所有特性</p>
<p><img alt="refresh" src="https://tva1.sinaimg.cn/large/006y8mN6gy1g73mt2hy6xg308m0iox3o.gif" /></p>
<p>本库已引入SmartRefreshLayout, 无需再次引入</p>
<div class="highlight"><pre><span></span><code><span class="n">implementation</span>  <span class="s1">&#39;com.scwang.smart:refresh-layout-kernel:2.0.1&#39;</span>
</code></pre></div>

<p>SmartRefreshLayout的指定的刷新头和刷新脚布局请分别依赖(其库如此设计)</p>
<p>可选配置的刷新头布局和脚布局</p>
<div class="highlight"><pre><span></span><code><span class="n">implementation</span> <span class="s1">&#39;androidx.appcompat:appcompat:1.0.0&#39;</span>                 <span class="c1">//必须 1.0.0 以上</span>

<span class="n">implementation</span>  <span class="s1">&#39;com.scwang.smart:refresh-layout-kernel:2.0.1&#39;</span>      <span class="c1">//核心必须依赖</span>
<span class="n">implementation</span>  <span class="s1">&#39;com.scwang.smart:refresh-header-classics:2.0.1&#39;</span>    <span class="c1">//经典刷新头</span>
<span class="n">implementation</span>  <span class="s1">&#39;com.scwang.smart:refresh-header-radar:2.0.1&#39;</span>       <span class="c1">//雷达刷新头</span>
<span class="n">implementation</span>  <span class="s1">&#39;com.scwang.smart:refresh-header-falsify:2.0.1&#39;</span>     <span class="c1">//虚拟刷新头</span>
<span class="n">implementation</span>  <span class="s1">&#39;com.scwang.smart:refresh-header-material:2.0.1&#39;</span>    <span class="c1">//谷歌刷新头 (内置)</span>
<span class="n">implementation</span>  <span class="s1">&#39;com.scwang.smart:refresh-header-two-level:2.0.1&#39;</span>   <span class="c1">//二级刷新头</span>
<span class="n">implementation</span>  <span class="s1">&#39;com.scwang.smart:refresh-footer-ball:2.0.1&#39;</span>        <span class="c1">//球脉冲加载</span>
<span class="n">implementation</span>  <span class="s1">&#39;com.scwang.smart:refresh-footer-classics:2.0.1&#39;</span>    <span class="c1">//经典加载 (内置)</span>
</code></pre></div>

<p>刷新布局要求必须先初始化, 推荐在Application中</p>
<div class="highlight"><pre><span></span><code>SmartRefreshLayout.setDefaultRefreshHeaderCreator { context, layout -&gt; ClassicsHeader(this) }
SmartRefreshLayout.setDefaultRefreshFooterCreator { context, layout -&gt; ClassicsFooter(this) }
</code></pre></div>

<h2 id="pagerefreshlayout">PageRefreshLayout<a class="headerlink" href="#pagerefreshlayout" title="Permanent link">&para;</a></h2>
<p>该控件继承自<code>SmartRefreshLayout</code>, 增加以下特性</p>
<ol>
<li>简化函数</li>
<li>细节优化</li>
<li>缺省页</li>
<li>分页加载</li>
<li>拉取加载更多</li>
<li>预加载 / 预拉取</li>
</ol>
<h3 id="_1">创建方式<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>支持两种方式创建, 推荐布局包裹, </p>
<div class="tabbed-set" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">代码包裹</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code>val page = rv.page()
</code></pre></div>

</div>
<input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><label for="__tabbed_1_2">布局包裹</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="nt">&lt;com.drake.brv.PageRefreshLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
<span class="na">xmlns:tools=</span><span class="s">&quot;http://schemas.android.com/tools&quot;</span>
<span class="na">xmlns:app=</span><span class="s">&quot;http://schemas.android.com/apk/res-auto&quot;</span>
<span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
<span class="na">android:id=</span><span class="s">&quot;@+id/page&quot;</span>
<span class="na">app:stateEnabled=</span><span class="s">&quot;true&quot;</span>
<span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
<span class="na">tools:context=</span><span class="s">&quot;com.drake.brv.sample.fragment.RefreshFragment&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;androidx.recyclerview.widget.RecyclerView</span>
<span class="na">android:id=</span><span class="s">&quot;@+id/rv&quot;</span>
<span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
<span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/com.drake.brv.PageRefreshLayout&gt;</span>
</code></pre></div>

</div>
</div>
<h3 id="_2">监听状态<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 下拉刷新</span>
<span class="n">page</span><span class="p">.</span><span class="n">onRefresh</span> <span class="p">{</span>
    <span class="c1">// 这里可以进行网络请求等异步操作</span>
<span class="p">}</span>

<span class="c1">// 上拉加载</span>
<span class="n">page</span><span class="p">.</span><span class="n">onLoadMore</span> <span class="p">{</span>
    <span class="c1">// 这里可以进行网络请求等异步操作</span>
<span class="p">}</span>
</code></pre></div>

<ol>
<li>如果<code>onLoadMore</code> 不调用则上拉加载同样也会回调<code>onRefresh</code>函数, 因为下拉刷新和上拉加载在一般接口中定义只是分页字段不一样</li>
<li></li>
</ol>
<h3 id="_3">缺省页<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>触发刷新状态(两者都会回调函数onRefresh)</p>
<ol>
<li><code>autoRefesh</code>  下拉刷新</li>
<li><code>showLoading</code>  加载Loading缺省页, 当然得先设置<code>loadingLayout</code>(或者读取<code>StateConfig</code>全局缺省页配置)</li>
<li><code>refresh</code> 静默刷新, 不会触发任何动画</li>
</ol>
<p>这3种方式都会导致索引<code>index=startIndex</code>重置.</p>
<p>缺省页状态控制</p>
<div class="highlight"><pre><span></span><code>showEmpty()
showError()
showContent
showLoading()
</code></pre></div>

<p><strong>配置全局缺省页</strong></p>
<p>这块代码和StateLayout公用</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">         *  推荐在Application中进行全局配置缺省页, 当然同样每个页面可以单独指定缺省页.</span>
<span class="cm">         *  具体查看 https://github.com/liangjingkanji/StateLayout</span>
<span class="cm">         */</span>
<span class="n">StateConfig</span><span class="p">.</span><span class="n">apply</span> <span class="p">{</span>
  <span class="n">emptyLayout</span> <span class="p">=</span> <span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">layout_empty</span>
  <span class="n">errorLayout</span> <span class="p">=</span> <span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">layout_error</span>
  <span class="n">loadingLayout</span> <span class="p">=</span> <span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">layout_loading</span>

  <span class="n">onLoading</span> <span class="p">{</span>
    <span class="c1">// 此生命周期可以拿到LoadingLayout创建的视图对象, 可以进行动画设置或点击事件.</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>单例缺省页配置支持两种方式</p>
<ol>
<li>XML</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;com.drake.brv.PageRefreshLayout</span> 
    <span class="err">.....</span>
    <span class="na">app:error_layout=</span><span class="s">&quot;@layout/layout_error&quot;</span>
    <span class="na">app:empty_layout=</span><span class="s">&quot;@layout/layout_empty&quot;</span>
    <span class="na">app:loading_layout=</span><span class="s">&quot;@layout/layout_loading&quot;</span><span class="nt">&gt;</span>
</code></pre></div>

<ol>
<li>代码</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">page</span><span class="p">.</span><span class="n">apply</span> <span class="p">{</span>
    <span class="n">loadingLayout</span> <span class="p">=</span> <span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">layout_loading</span>
    <span class="n">emptyLayout</span> <span class="p">=</span> <span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">layout_empty</span>
    <span class="n">errorLayout</span> <span class="p">=</span> <span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">layout_error</span>
<span class="p">}</span>
</code></pre></div>

<p>默认会使用缺省页, 如果你已经设置了全局缺省页但是此刻不想使用. 可以使用属性|函数: <code>stateEnabled</code></p>
<p>想要使用缺省页又要求缺省页不遮盖头布局, 头布局请使用<code>CoordinatorLayout</code>实现. 注意使用<code>NestedScrollView</code>会导致rv一次性加载完item内存消耗大.</p>
<h3 id="_4">刷新数据<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>前面提到 PageRefreshLayout 支持自动分页加载</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 设置分页加载第一页的索引, 默认=1, 触发刷新会重置索引. 如果需要修改在Application设置一次即可</span>
<span class="c1">// PageRefreshLayout.startIndex = 1</span>

<span class="n">pageLayout</span><span class="p">.</span><span class="n">onRefresh</span> <span class="p">{</span> 
  <span class="c1">// 下拉刷新和上拉加载都会执行这个网络请求, 除非另外设置onLoadMore</span>
  <span class="k">get</span><span class="p">(</span><span class="s">&quot;/path&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">param</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">,</span> <span class="s">&quot;value&quot;</span><span class="p">)</span>
      <span class="n">param</span><span class="p">(</span><span class="s">&quot;page&quot;</span><span class="p">,</span> <span class="n">pageLayout</span><span class="p">.</span><span class="n">index</span><span class="p">)</span> <span class="c1">// 这里使用框架提供的属性</span>
  <span class="p">}.</span><span class="n">page</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 该回调函数参数返回一个布尔类型用于判断是否存在下一页, 决定上拉加载的状态. 以及当前属于刷新还是加载更多条目</span>
    <span class="n">addData</span><span class="p">(</span><span class="k">data</span><span class="p">){</span> <span class="n">adapter</span><span class="p">.</span><span class="n">itemCount</span> <span class="p">&lt;</span> <span class="k">data</span><span class="p">.</span><span class="n">count</span> <span class="c1">// 这里是判断是否由更多页, 具体逻辑根据接口定义 } </span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>这里的网络请求使用的是我开源的另一个项目Net, 支持扩展BRV. GitHub: <a href="https://github.com/liangjingkanji/Net">Net</a>.  </p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Application footer -->
<footer class="md-footer">

    <!-- Link to previous and/or next page -->
    
    <div class="md-footer-nav">
        <nav
                class="md-footer-nav__inner md-grid"
                aria-label="Footer"
        >

            <!-- Link to previous page -->
            
            <a
                    href="../divider/"
                    title="分割线"
                    class="md-footer-nav__link md-footer-nav__link--prev"
                    rel="prev"
            >
                <div class="md-footer-nav__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
                </div>
                <div class="md-footer-nav__title">
                    <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                        分割线
                    </div>
                </div>
            </a>
            

            <!-- Link to next page -->
            
            <a
                    href="../state/"
                    title="缺省页"
                    class="md-footer-nav__link md-footer-nav__link--next"
                    rel="next"
            >
                <div class="md-footer-nav__title">
                    <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                        缺省页
                    </div>
                </div>
                <div class="md-footer-nav__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
                </div>
            </a>
            
        </nav>
    </div>
    

    <!-- Further information -->
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">

            <!-- Copyright and theme information -->
            <div class="md-footer-copyright">
                
                <div class="md-footer-copyright__highlight">
                    Copyright &copy; 2016 - 2020 Drake
                </div>
                
            </div>

            <!-- Social links -->
            
        </div>
    </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.592d4e23.min.js"></script>
      <script src="../assets/javascripts/bundle.073197b2.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.01088dc6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>